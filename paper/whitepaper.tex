\documentclass[runningheads,a4paper]{llncs}

\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage[T1]{fontenc}
\usepackage[scaled]{beramono}
\usepackage{listings}
\usepackage{color}
\usetikzlibrary{arrows,chains,positioning,scopes,quotes,calc}
\usepackage{float}

\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\endspace\ignorespaces#1}
\pagestyle{plain}
\setlength\parindent{0pt}

\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\newcommand*{\StrikeThruDistance}{0.15cm}%
\newcommand*{\StrikeThru}{\StrikeThruDistance,\StrikeThruDistance}%

\tikzset{strike thru arrow/.style={
    decoration={markings, mark=at position 0.5 with {
        \draw [blue, thick,-] 
            ++ (-\StrikeThruDistance,-\StrikeThruDistance) 
            -- ( \StrikeThruDistance, \StrikeThruDistance);}
    },
    postaction={decorate},
}}

\lstset{
  language=Python,
  showstringspaces=false,
  formfeed=\newpage,
  tabsize=4,
  commentstyle=\itshape,
  basicstyle=\ttfamily,
  morekeywords={models, lambda, forms}
}

\begin{document}
\def \SystemName {Worlds} % Lol because this shit probably will change.

\mainmatter  % start of an individual contribution

% This needs some work, big time.
\title{\SystemName: A distributed MMO \textit{(DRAFT)}}

\author{Ryan Walker\\
				ryan.cjw@gmail.com}

\institute{} %Merp

\maketitle
%% Scrum area
%% TODO:
% Not controlled by centralized organization.
% How/Where are the actual files hosted? Client Files??
%	-> How are these fetched?

\begin{abstract}
A protocol defining how anyone can contribute to an unbounded universe could allow the flexibility to organically grow an MMO faster than any proprietary system. This paper overviews a protocol that enables developers to bolt their game into in common universe. 
\end{abstract}

\section{Worlds}
\subsection{Introduction}
For an open software ecosystem to grow organically there should be outlets for contribution. In the context of a massively multiplayer online game the outlets become more complicated then a simple code repository. Fair game mechanics are built on a fragile ecosystem that have negative consequences if managed improperly. Forming consensus on a network is trivially done with conventional methods. A server maintains a secure connection with a player who pipes actions to the server. The server then provides ground truth for the network. Our model replacing a centralized organization with a smart contract which forms consensus and balances the economics of the universe. The user experience is designed by anyone who wishes to contribute.

\subsection{Overview}
A world, defined as $w_k$, is a node that designs a user experience and hosts players. Worlds provide the game client which the players interact with. In addition they govern their world and create the elements that make it unique. A world can have up to four adjacent worlds determined by itself. Thus forming a network, which allows players to explore and move common items (\ref{items}), experience (\ref{exp}) and currency (\ref{money}) between worlds.

\begin{small}
\tikzset{myblock/.style = {rectangle, draw, minimum height=1cm, minimum width=3cm}}
\begin{center}
\begin{tikzpicture}
\label{Hello}
\node(WE)[myblock]{\begin{tabular}{c}Worlds Engine \\ {\scriptsize wClient.py} \\\end{tabular}};
\node (WS)[myblock,above of=WE, yshift=1cm]{\begin{tabular}{c}Worlds Server \\ {\scriptsize wServer.py} \\\end{tabular}};
\node (WC)[myblock,left of=WE, xshift=-3cm]{\begin{tabular}{c}Game Client \\ {\scriptsize \textit{From game Dev}} \\\end{tabular}};
\node (SE)[myblock,left of=WS, xshift=-3cm]{\begin{tabular}{c}Server Engine \\ {\scriptsize \textit{From game Dev}} \\\end{tabular}};
\node (WSC)[myblock,right of=WS, xshift=3cm, yshift=-1cm]{\begin{tabular}{c}Smart Contract (\ref{WSC}) \\ {\scriptsize \textit{On Chain}} \\\end{tabular}};

\draw [dashed] (-6,1) -- (2,1);
\draw [dashed] (2,2.5) -- (2,-0.5);

\node [left of=SE, xshift=-1cm]{\begin{tabular}{c}Server\\Side\end{tabular}};
\node [left of=WC, xshift=-1cm]{\begin{tabular}{c}Client\\Side\end{tabular}};
\node [below of=WSC]{Blockchain};

% \draw[<->] ($(WE.north east)!0.5!(WE.north west)$) --  ($(WS.south east)!0.5!(WS.south west)$);
\draw[<->] (WC) -- (WE);
\draw[<->] (SE) -- (WS);
\draw[<->] (SE) -- (WC);
\draw[<->] ($(WSC.north west)!0.25!(WSC.south west)$) --  ($(WS.north east)!0.5!(WS.south east)$);
\draw[<->] ($(WSC.north west)!0.75!(WSC.south west)$) --  ($(WE.north east)!0.5!(WE.south east)$);
% TODO: Change the arrow heads. 
\end{tikzpicture}
\end{center}
\end{small}
The worlds engine is an application that manages the elements that are common throughout all worlds, such as player keys, hashing+signing and fetching the files required to run the game client. The world designer has full creative freedom over the game client and server engine. This is what will enable the highest flexibility and the most unique universe. It is possible for clusters of worlds to share a single game client, yet design their own experience. Conversely, adjacent worlds might have completely different game clients, where players might move from a text based MUD into a fully 3D world. 

\section{Worlds Smart Contact (WSC)}
\label{WSC}
The worlds smart contract is used to form consensus among the network. It contains functions and data elements that are used as various forms of proof that require interoperability between worlds. An appropriate blockchain with the following requirements has not yet been selected.

\begin{itemize}
\item{Low networks fees}
\item{Fast transactions for in game purchases}
\item{Decent data capacity to hold merkal proofs}
\end{itemize}

% \subsection{Function Listing}
% TODO

\section{Actions}
Actions are defined as anything a node can do to effect anything in the network. Messages and data packages are to be considered actions in this context.

\subsection{Direct Action}
A direct action is any action that is travels between the Server Engine and the Game Client. These actions have the lowest latency and lowest security. An example of an action like this might be the Server engine telling the Game Client of some in game event.

\subsection{Proof Action}
A proof action are actions that require the use of private keys for signing, but then relay the signed package from the Game Client to the Server Engine. For nodes that require higher security it is possible to hold the Worlds Server or Worlds Engine offline therefor keeping their keys offline. 

\subsection{Contract Action}
Contract actions are any actions that communicate with the Worlds Smart Contract. They can be issues from the Worlds Engine directly, or the Game Client can pipe action requests into the worlds engine. 

\section{Experience}
\label{exp}
Experience is distributed to players using experience packages. These are of the form (Figure \ref{exppkg}). When a player is to received experience this package is hashed, signed and sent to the \textit{Worlds Smart Contract} (\ref{WSC})(WSC). The world must stake some WOR in order to grant experience. Experience is distributed like items, although it is not transferable. It is possible for experience to be liquidated back into WOR by the players. Worlds can decide the effect of player experience, typically the more WOR that is staked the larger the effect can be. As players are the same entity as worlds as far as WSC is concerned it is possible for player to stake their own WOR and buy experience. However this experience is stamped with the public key of the issuer and it's possible that worlds might not accept this during the worlds transfer. 


\begin{figure}[H]
\centering
\caption{Experience Package - Sword Fighting}
\label{exppkg}
\begin{lstlisting}
ExpClass = 'SwordFighting'
ExpHash = hash(ExpClass);
PlayerPublic = 0x5d7ac22131ad370e59fddb5f6079a354dbdd2dd9
WorldPublic = 0xb1abdaf3ab936c99f5fd518122cf7d5b811a1a30
IssueTime = UnixTime #Time of Issue
Stake = 0.1WOR
\end{lstlisting}
\end{figure}

\subsection{Receiving Experience} 
In the interest is keeping latency low, experience is distributed to players when they leave the world. This is not to say that they can not use gained experience immediately in the current world. As the WSC is just for locking funds and providing proof to other worlds. To save space on the blockchain it is possible to form a merkel tree of all received experience. The player is required to keep all the original data. 

\section{Items} 
\label{items}
Items can be introduced by any node on the network. To spawn an item the item package, defined as $i$, must be signed by the node and submitted to the \textit{worlds smart contract} to prove ownership and lock the funds associated with the item. It is the worlds responsibility to judge which items are credible. This can be done by examining the \textit{WorldPublic} field in the item package, if it has been issued by an adjacent or trusted world the item can be considered real. It is also possible that some worlds might not care if players create items for themselves, in this case the \textit{WorldPublic} would match the \textit{PlayerPublic} field. These options are left completely up to the world creator. It is possible for items to be liquidated back into WOR.

\begin{figure}[H]
\centering
\label{itempkg}
\caption{Item Package $i$ - Wood}
\begin{lstlisting}
ItemName = 'Wood'
ItemClass = 'Material'
PlayerPublic = 0x5d7ac22131ad370e59fddb5f6079a354dbdd2dd9
WorldPublic = 0xb1abdaf3ab936c99f5fd518122cf7d5b811a1a30
UnixTime = 
Stake = 1WOR
ItemHash = hash(ItemName | ... | Stake);
\end{lstlisting}
\end{figure}

\subsection{Item Transfers}
A player must call the TxItem(ItemHash, NewHash, PlayerPublic) function in order to transfer an item. 

For a player to transfer an item to another player, the player must call the TxItem(ItemHash, PlayerPublic) function on the WSC. 

\subsection{Staked Amounts}
In order to have a balanced economy the monetary system needs to be net zero \ref{money}. The same holds true for experience and items, this balance is achieved by staking WOR into items and EXP.

\subsection{Forging}
It is possible to forge items by combining multiple items, thus forming a derivative item. In literal sense the act of forging it to call the function \textit{ForgeItem(Item1, Item2, ...)} on the WSC. This will then make a derivative item which is shown in Figure \ref{ForgedItem}. It is up to the worlds to decide on the item names and item classes of these subitems. To forge a sword a player could forge metal, fabric and a sharpening stone. As long at the world recognizes that the resulting hash of these items do in fact form a sword, then the player has crafted a sword for use in these worlds. The power of the sword would be proportional to the amount of stakes WOR in all the items that were used to craft the sword. Once items are forged into something they can no longer be used for anything else. It is possible to unforge an item.

\begin{figure}[H]
\centering
\caption{Forged Item $i_f$}
\label{ForgedItem}
\begin{lstlisting}[escapeinside={(*}{*)}]
ItemHash = hash((*$ParentItemHash_0 | ... | ParentItemHash_n$*))
PlayerPublic = 0x5d7ac22131ad370e59fddb5f6079a354dbdd2dd9
Stake = sum(ParentItemStake)
\end{lstlisting}
\end{figure}

\subsection{Equipping Items}
Depending on the requirement of the world, players may be required to stake items in order to use them. There is more on this in section \ref{Staking}.

\subsection{Using items}
If a player wants to use an item, it must be transferred to the world the player is currently residing in. 


\section{Currency (WOR)}
\label{money}
A common currency between worlds will be used for staking and integration into the platform. To prevent abuse this currency must be zero sum, meaning worlds cannot generate it and it must start with a fixes supply. Ideally it is tracked through an existing blockchain. Worlds can introduce mechanics for generating revenue, like entrance fees, subscriptions or purchasing items.

\section{Transport}
To prevent players from playing on multiple worlds concurrently a player location is kept on the worlds smart contract. This location is the public key of the world that the player currently resides. In order for this to be valid it must be signed by the player and the world the player resides in. If a player wishes to travel to a world... 

\begin{itemize}
\item{The player must send a signed entry request package must be sent to the world.}
\item{If the world only allows travel from adjacent worlds the player may be denied.}
\item{The player provides proof of items and experience.}
\item{The world might check the public key stamped the items/exp to ensure they are from creditable sources.}
\item{Items or experience are staked if required to be.}
\item{Player is granted access, WSC is updated with player location.}
\end{itemize}

\section{World Incentivisation}
If worlds want to distribute items or experience they must stake some WOR into items. As WOR has monetary value worlds need a way to generate some revenue.

\subsection{Staking}
\label{Staking}
Some worlds may require you to stake some experience, items or WOR before entering. This is effectively temporarily moving these things into possession of the world. If the player is to die, the staked things will fall under ownership of the world. The world could then redistribute the items among other player, liquidate the items for WOR or a hybrid of the two.

\subsection{Fees}
Just like conventional games, it is possible the worlds might charge an entrance fees. These could be one time or reoccurring.

\subsection{In Game Purchases}
Just like in the real world it is possible to sell things for WOR.

\section{Engine Mechanics} 
The mechanics below are simply suggestions. As the engine is completely open, worlds are free to impose whatever mechanics they wish. Worlds with drastically different game mechanics will probably not be bordering, this limits gameplay but maintains fairness. Players are able to play in whatever worlds they wish - but they must start from scratch in non-adjacent clusters.

% Clusters of worlds might be complete anarchy, others built on peace and justice. There will probably not be a connection between sections like this, which is perfectly fine.

\section{System Architecture}
\begin{center}
\begin{tabular}{r l}
$A$: & Action\\ 
$Cy(A)$: & Signed Action\\
$R$: & Response\\ 
$Cy(R)$: & Signed Response\\

\end{tabular}
\end{center}

\begin{small}
\tikzset{myblock/.style = {rectangle, draw, minimum height=1cm, minimum width=3cm}}
\begin{center}
\begin{tikzpicture}
\node(WE)[myblock]{\begin{tabular}{c}Worlds Engine \\ {\scriptsize wClient.py} \\\end{tabular}};
\node (WS)[myblock,above of=WE, yshift=1cm]{\begin{tabular}{c}Worlds Server \\ {\scriptsize wServer.py} \\\end{tabular}};
\node (WC)[myblock,left of=WE, xshift=-3cm]{\begin{tabular}{c}Game Client \\ {\scriptsize \textit{From game Dev}} \\\end{tabular}};
\node (Key)[myblock,below of=WE, yshift=-1cm]{\begin{tabular}{c}Key Pair \\ {\scriptsize private.pem/public.pem} \\\end{tabular}};
\node (AL)[myblock,right of=Key, xshift=3cm]{\begin{tabular}{c}Action Ledger \\ {\scriptsize AL/} \\\end{tabular}};
\node (AList)[myblock,left of=Key, xshift=-3cm]{\begin{tabular}{c}Action Listing \\ {\scriptsize ActionListing.yaml} \\\end{tabular}};
\node (PF)[myblock,below of=AList, yshift=-1cm]{\begin{tabular}{c}Player File \\ {\scriptsize player.yaml} \\\end{tabular}};

\draw[->] ($(WE.north east)!0.25!(WE.north west)$) -- node[anchor=west]{$Cy(A)$} ($(WS.south east)!0.25!(WS.south west)$);
\draw[<-] ($(WE.north east)!0.75!(WE.north west)$) -- node[anchor=west]{$Cy(R)$} ($(WS.south east)!0.75!(WS.south west)$);
\draw[->] (WC) -- node[anchor=north]{$A$} (WE);
\draw[<-] (WE) -- (Key);
\draw[<->] (AList) -- (WC);
\draw ($(AList.north east)!0.25!(AList.north west)$)edge[out=90,in=-90,->]($(WE.south east)!0.75!(WE.south west)$);
\draw ($(AL.north east)!0.5!(AL.north west)$)edge[out=90,in=-90,<->]($(WE.south east)!0.25!(WE.south west)$);
\draw ($(PF.north)!0.5!(PF.north)$)edge[out=90,in=-90,<-]($(WE.south east)!0.63!(WE.south west)$);
\draw ($(PF.north west)!0.5!(PF.south west)$)edge[out=180,in=-180,->]($(WC.south west)!0.5!(WC.north west)$);

% more arrows here
\end{tikzpicture}
\end{center}
\end{small}

\section{Outstanding Issues}

\subsection{Malicious Worlds}

\end{document}
